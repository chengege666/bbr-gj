#!/bin/bash
# å…¬å…±å‡½æ•°æ¨¡å—

# -------------------------------
# é¢œè‰²å®šä¹‰
# -------------------------------
RED="\033[1;31m"
GREEN="\033[1;32m"
YELLOW="\033[1;33m"
MAGENTA="\033[1;35m"
CYAN="\033[1;36m"
RESET="\033[0m"

# -------------------------------
# åŸºç¡€å‡½æ•°
# -------------------------------
print_welcome() {
    clear
    echo -e "${CYAN}==================================================${RESET}"
    echo -e "${MAGENTA}              å¢å¼ºç‰ˆ VPS å·¥å…·ç®± v1.3.0           ${RESET}"
    echo -e "${CYAN}--------------------------------------------------${RESET}"
    echo -e "${YELLOW}åŠŸèƒ½: BBR, ç³»ç»Ÿç®¡ç†, é˜²ç«å¢™, Docker, NPMç­‰${RESET}"
    echo -e "${GREEN}æµ‹é€Ÿç»“æœä¿å­˜: bbr_result.txt${RESET}"
    echo -e "${CYAN}==================================================${RESET}"
    echo ""
}

check_root() {
    if [ "$(id -u)" -ne 0 ]; then
        echo -e "${RED}âŒâŒâŒâŒ é”™è¯¯ï¼šè¯·ä½¿ç”¨ root æƒé™è¿è¡Œæœ¬è„šæœ¬${RESET}"
        echo "ğŸ‘‰ ä½¿ç”¨æ–¹æ³•: sudo bash vpsgj.sh"
        exit 1
    fi
}

check_deps() {
    PKGS="curl wget git speedtest-cli net-tools build-essential iptables"
    for CMD in curl wget git speedtest-cli iptables; do
        if ! command -v $CMD >/dev/null 2>&1; then
            echo -e "${YELLOW}æœªæ£€æµ‹åˆ° $CMDï¼Œæ­£åœ¨å°è¯•å®‰è£…ä¾èµ–...${RESET}"
            install_deps
            break
        fi
    done
}

install_deps() {
    PKGS="curl wget git speedtest-cli net-tools build-essential iptables"
    if command -v apt >/dev/null 2>&1; then
        apt update -y
        apt install -y $PKGS
    elif command -v yum >/dev/null 2>&1; then
        yum install -y $PKGS
    elif command -v dnf >/dev/null 2>&1; then
        dnf install -y $PKGS
    else
        echo -e "${YELLOW}âš ï¸ æœªçŸ¥ç³»ç»Ÿï¼Œè¯·æ‰‹åŠ¨å®‰è£…ä¾èµ–: $PKGS${RESET}"
        read -n1 -p "æŒ‰ä»»æ„é”®ç»§ç»­èœå•..."
    fi
}

# å¸è½½åŠŸèƒ½
uninstall_script() {
    read -p "ç¡®å®šè¦å¸è½½æœ¬è„šæœ¬å¹¶æ¸…ç†ç›¸å…³æ–‡ä»¶å— (y/n)? ${RED}æ­¤æ“ä½œä¸å¯é€†!${RESET}: " confirm_uninstall
    if [[ "$confirm_uninstall" == "y" || "$confirm_uninstall" == "Y" ]]; then
        echo -e "${YELLOW}æ­£åœ¨æ¸…ç†è„šæœ¬æ–‡ä»¶...${RESET}"
        
        # åˆ é™¤ä¸»è„šæœ¬å’Œæ¨¡å—ç›®å½•
        rm -f vpsgj.sh
        rm -rf modules/
        rm -f bbr_result.txt
        
        echo "Script uninstalled on $(date)" > "vps_toolbox_uninstall_done.txt"
        echo -e "${GREEN}âœ… è„šæœ¬å¸è½½å®Œæˆã€‚${RESET}"
        exit 0
    fi
}
